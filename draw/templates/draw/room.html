{% load static %}

<!DOCTYPE html>
<html class="mx-5 mb-0">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>P4 Drawing</title>

    <link rel="stylesheet" type="text/css" href="{% static 'draw/vendor/bootstrap/css/bootstrap.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'draw/style.css' %}" />

    <script type="text/javascript" src="{% static 'draw/vendor/jquery/jquery-3.3.1.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'draw/vendor/paper/paper-full.min.js' %}"></script>

    <style type="text/css">
      form {
        margin: 0 auto;
        padding: 1em;
        border: 1px solid #CCC;
        border-radius: 1em;
        box-shadow: 5px 5px 5px 5px;
        background-color: beige;
      }
      label {
        display: inline-block;
        text-align: right;
        font-size: 2em;
      }
      .formelem {
        text-align: center;
      }
      textarea {
        vertical-align: top;
        width: 50%;
        /* height: 30%; */
      }
      
      input:focus,
      textarea:focus {
        /* Additional highlight for focused elements */
        border-color: #000;
      }
      
    </style>

</head>
<body class="bg-secondary">
  <h1 class="m-5 p-5 text-center border border-dark rounded bg-warning">Caravan</h1>
  <div class="container-flex">
    <div class="row">
      <div class="col ml-3">
        <h2 class="py-5 text-center border border-dark rounded bg-warning">Recommendations!</h2>

      <div class="container-flex">
        <div class="row no-gutters">
          <div class="col-6 flex-column">
            <div class="sticky-note">OK</div>
            <div class="sticky-note">i kinda went sicko mode</div>
          </div>
          <div class="col-6 flex-column">
            <div class="sticky-note">sorry</div>
            <div class="sticky-note">that mb</div>
          </div>
        </div>
      </div>

      </div>
      <div class="col">
        <h2 class="py-5 text-center border border-dark rounded bg-warning">How was your experience?</h2>

        <div class="container-flex">
          <div class="row no-gutters">
            <div class="col-6 flex-column">
              <div class="sticky-note">but hey</div>
              <div class="sticky-note">it works</div>
            </div>
            <div class="col-6 flex-column">
              <div class="sticky-note">it looks ok</div>
              <div class="sticky-note">no?</div>
            </div>
          </div>
        </div>

      </div>
      <div class="col mr-3">
        <h2 class="py-5 text-center border border-dark rounded bg-warning">Anything you want!</h2>

        <div class="container-flex">
          <div class="row no-gutters">
            <div class="col-6 flex-column">
              <div class="sticky-note">i know</div>
              <div class="sticky-note">the amount of bootstrap</div>
            </div>
            <div class="col-6 flex-column">
              <div class="sticky-note">hard to read</div>
              <div class="sticky-note">just msg me if you have questions</div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- <div class="row">
      <div class="col d-flex justify-content-center">
        <div class="sticky-note"></div>
        <div class="sticky-note"></div>

      </div>
      <div class="col d-flex justify-content-center">
        <div class="sticky-note"></div>
        <div class="sticky-note"></div>

      </div>
      <div class="col d-flex justify-content-center">
        <div class="sticky-note"></div>
        <div class="sticky-note"></div>

      </div>
    </div> -->
  </div>

  <form action="" method="get" id="form">
    <div class="formelem">
      <label for="msg">Message:</label>
      <textarea id="msg" name="user_message"></textarea>
    </div>
    <div class="formelem">
      <input type="submit" value="Send">
    </div>
  </form>


</body>
<script>
  var searchParams = new URLSearchParams(window.location.search);
  var uid = Date.now() % 10000;
  var noteList = new Map();

  var socket = new WebSocket(
      'ws://' + window.location.host + '/ws/draw');

  for (const [key, value] of searchParams) {
    console.log("\nkey: " + key + "\nvalue: " + value);
    if (key == "user_message") {
      noteList.set(uid, value);
      socket.send("{\"text\" : " + noteList.get(uid) + ", \"uid\" : " + uid + "}" );
    }
  }
  
  //is called everytime message is received
  socket.onmessage = function(receivedMessage) {
    var received = JSON.parse(receivedMessage.data);
    console.log(received);
  }

  socket.onclose = function(e) {
      console.error('Chat socket closed unexpectedly');
  };

</script>
</html>
